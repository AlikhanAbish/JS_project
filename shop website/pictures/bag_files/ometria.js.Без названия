(()=>{"use strict";function a(a,t,e){null!=a&&window.ometria.init(a,t,e)}function t(a){null!=a&&window.ometria.trackTransaction(a)}function e(a){var t=new window.ometria.Basket,e=function(a){var t=[];return a.forEach((function(a){var e=a.pid,i=a.totalPrice,o=a.quantity,r=a.vid;t.push({id:e,price:i,quantity:o,vid:r})})),t}(a.cartitems),i=a.ometriaBasketTotal,o=a.ometriaBasketId,r=a.currencyCode;Array.isArray(e)&&e.length>0?(e.forEach((function(a){var e=a.inBasket||a.quantity;a.vid&&""!==a.vid?t.addLineItem(a.id,parseInt(e,10),a.price.toFixed(2),a.vid):t.addLineItem(a.id,parseInt(e,10),a.price.toFixed(2))})),t.setTotal(i,r),t.setId(o)):(t.setTotal(0,r),t.setId("")),t.setUrl(a.basketUrl||window.location.href),window.ometria.setBasket(t)}function i(a){var t={};if(""!==a){var e=$(a).data("nsprefix");t={pid:""!==e&&null!=e?e+$(a).data("pid"):$(a).data("pid")}}return t}function o(){var a=$(".om_sitedata").data("basketdataurl");$.ajax({url:a,type:"get",dataType:"json",success:function(a){e(a.ometriaBasket)}})}function r(a){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(a).toLowerCase())}$("body").on("cart:update",(function(){o()})),$("body").on("minicart:update",(function(){o()})),$("body").on("product:afterAddToCart",(function(a){var t=a.detail;if(t&&!t.error){e(t.cart.ometriaBasket);var i=t.ometriaInfo.pid,o=t.cart.ometriaBasket.ometriaNSPrefix;""!==o&&null!==o&&(i=o+i),window.ometria.trackAddToBasket(i,t.ometriaInfo.quantity)}})),$("body").on("ometria:checkoutConfirmed",(function(e){a("confirmation",""!==$("span.om_page").data("pagedata")?$("span.om_page").data("pagedata"):null,$("span.om_sitedata").data("storeid")),t(e.detail.orderId)})),$(document).ready((function(){var o=$("span.om_page").data("pagetype"),n=""!==$("span.om_page").data("pagedata")?$("span.om_page").data("pagedata"):null;switch(o){case"product":n=i("span.om_page");break;case"search":o="listing",n={attributes:[{type:"search"}]};break;case"category":var d=$("span.om_page").data("department"),c=$("span.om_page").data("category");o="listing",n={attributes:[{id:d,type:"department"},{id:c,type:"category"}]};break;case"order":o="listing",n={attributes:[{type:"orders"}]};break;case"basket":var s=$("span.om_page").data("basketdata");null!==s&&e(s);break;case"confirmation":t($("span.om_page").data("orderid"));break;case"account":case"checkout":var p=$("span.om_page").data("email");r(p)&&window.ometria.identify(p)}var u=$("span.om_sitedata").data("storeid");a(o,n,u),$("body").on("quickview:ready",(function(){o=$("span.om_quickview").data("pagetype"),n=i("span.om_quickview"),a(o,n,u)})),$("form.login").on("login:success",(function(a,t){var e=t.ometriaEmail;""!==e&&window.ometria.identify(e)})),$("form.registration").on("login:register:success",(function(a,t){var e=t.ometriaEmail;""!==e&&window.ometria.identify(e)})),"checkout"===o&&$(".js-step-pay").click((function(){var a=$("span.om_page").data("email");r(a)&&window.ometria.identify(a)})),$(".subscribe-email").click((function(){var a=$("input[name=hpEmailSignUp]").val();r&&window.ometria.identify(a)}));var m=new URLSearchParams(window.location.search).get("om_profile");null!==m&&window.ometria.identify(m),"product"===o&&$("body").on("product:afterAttributeSelect",(function(a){var t=document.querySelector('[data-pagetype="product"]');return!!(t&&a&&a.detail&&a.detail.product&&a.detail.product.id)&&(t.setAttribute("data-pid",a.detail.product.id),!0)}))}))})();